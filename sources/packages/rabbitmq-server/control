#!/bin/bash

NAME="rabbitmq-server"
VERSION=2.4.1
RELEASE=0
DESCRIPTION=""
REQUIRES="canohome pkgmgr erlang canotools"

function install(){
	echo "Install $NAME $VERSION-$RELEASE ..."
	mkdir -p $PREFIX/var/lib/rabbitmq $PREFIX/var/log/rabbitmq
	$PREFIX/etc/init.d/rabbitmq-server start

	echo " + Declare Admin user ..."
	$PREFIX/bin/rabbitmqadmin declare user name=admin password=admin administrator=true
	echo " + Declare vhost ..."
	$PREFIX/bin/rabbitmqadmin declare vhost name=canopsis
	echo " + Declare permissions for guest user ..."
	$PREFIX/bin/rabbitmqadmin -V canopsis declare permission vhost=canopsis user=guest configure=".*" write=".*" read=".*"

	$PREFIX/etc/init.d/rabbitmq-server stop
	check_code $?
}

function remove(){
	echo "Remove $NAME $VERSION-$RELEASE ..."
	service rabbitmq-server stop 
	#check_code $?
}

function purge(){
	echo "Purge $NAME $VERSION-$RELEASE ..."
	rm -Rf $PREFIX/var/lib/rabbitmq
	rm -Rf $PREFIX/var/log/rabbitmq
	#check_code $?
}

function update(){
	echo "Update $NAME $VERSION-$RELEASE ..."
	check_code $?
}
