#!/bin/bash

NAME="snmp2amqp"
VERSION=0.1
RELEASE=0
DESCRIPTION=""
REQUIRES="canohome pkgmgr python canolibs"

NO_ARCH=true
NO_DIST=true
NO_DISTVERS=true

function pre_install(){
	echo "Pre-install $NAME $VERSION-$RELEASE ..."
	check_code $? 
}

function post_install(){
	echo "Post-install $NAME $VERSION-$RELEASE ..."
	SUDOCMD="$HUSER ALL=NOPASSWD: $PREFIX/bin/python $PREFIX/opt/$NAME/$NAME.py"
	if [ `id -u` -eq 0 ]; then
		if [ `cat /etc/sudoers | grep $NAME | wc -l` -eq 0 ]; then
			echo "$SUDOCMD" >> /etc/sudoers
			sed -i 's/Defaults\tenv_reset/Defaults\t!env_reset/g' /etc/sudoers
			check_code $? "Impossible to configure sudo"
		fi
	else
		echo " + Please insert '$SUDOCMD' in your sudoers file (/etc/sudoers)"
		echo " + And change \"Defaults env_reset\" by \"Defaults !env_reset\""
	fi
}

function pre_remove(){
	echo "Pre-remove $NAME $VERSION-$RELEASE ..."
	check_code $?
}

function post_remove(){
	echo "Post-remove $NAME $VERSION-$RELEASE ..."
	check_code $?
}

function pre_update(){
	echo "Pre-update $NAME $VERSION-$RELEASE ..."
	check_code $?
}

function post_update(){
	echo "Post-update $NAME $VERSION-$RELEASE ..."
	check_code $?
}

function purge(){
	echo "Purge $NAME $VERSION-$RELEASE ..."
	check_code $?
}
