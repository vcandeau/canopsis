#!/bin/bash

function clean_cache(){
    echo " :: Clean cache"
    echo "   + Remove Remote Db"
    rm -Rf $REMOTE_DB_PATH
	echo "   + Remove old packages"
	for file in $PACKAGES_PATH/* ; do
		keep_it="False"
		while read line; do
        	L_PNAME=$(echo "$line" | cut -d '|' -f1)
			tmp="${file%.[^.]*}"
			C_PNAME="${tmp##*/}"
			if [ "$C_PNAME" == "$L_PNAME" ]; then
				keep_it="True"
			fi
    	done < "$LOCAL_DB_PATH"
		if [ "$keep_it" == "False" ]; then
			rm -Rf $file
		fi
	done
    check_code $? "Failure during remove old database"
    echo "   + Update Pkgmgr info file"
    sed "/LAST_UPDATE/d" -i $VARLIB_PATH/info
	echo "   + Remove tmp.file"
	rm -Rf $TMP_FILE
    echo "   + Done"
    exit 1
}
