<html>
<head>
    	<title>Authentification</title>
	<link rel="stylesheet" type="text/css" href= "resources/lib/extjs/resources/css/ext-all.css">
	<link rel="stylesheet" type="text/css" href="themes/default/theme.css">
        <link rel="stylesheet" type="text/css" href="themes/canopsis/theme.css">

	<script type="text/javascript" src="resources/lib/extjs/ext-all.js"></script>
</head>
<body>
	<div id="div-header">
		<div id="title"><h1>Canopsis</h1></div>
		<div id="logo"/></div>
	</div>

	<div id="form" style='margin: 50 auto; width: 350;'></div>

	<script type="text/javascript">
		
		//function to return parameters in the url
		function getURLParameter(name) {
			return decodeURI(
				(RegExp(name + '=' + '(.+?)(&|$)').exec(location.search)||[,null])[1]
			);
		}
		
		
		Ext.require([
			'Ext.form.Panel',
		]);

		Ext.onReady(function(){
			var winform = Ext.create('Ext.form.Panel', {
				url:'/auth',
				frame:true,
				title: 'Authentification',
				renderTo: 'form',
				fieldDefaults: {
					msgTarget: 'side',
					labelWidth: 75
				},
				defaultType: 'textfield',
				defaults: {
					anchor: '100%'
				},
		
				items: [{
					fieldLabel: 'Login',
					name: 'login',
					allowBlank:false
				},{
					fieldLabel: 'Password',
					name: 'password',
					inputType: 'password',
					allowBlank:false
				}],
				buttons: [{
					text: 'Login',
					handler: function() {
					var form = this.up('form').getForm(); // get the basic form
					if (form.isValid()) { // make sure the form contains valid data before submitting
						form.submit({
							method: 'GET',
							success: function(form, action) {
								var param = getURLParameter('url');	
								if(param != 'null'){
									window.location.href=param;
								} else {
									window.location.href='/';
								}
							},
							failure: function(form, action) {
								Ext.MessageBox.alert('authentification failed', 'login or password incorrect');
							}
						});
					} else { // display error alert if the data is invalid
						Ext.Msg.alert('Invalid Data', 'Please correct form errors.')
					}
				}
				}]
			});


		});

	</script>


</body>
</html>
