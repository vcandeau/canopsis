/*
#--------------------------------
# Copyright (c) 2011 "Capensis" [http://www.capensis.com]
#
# This file is part of Canopsis.
#
# Canopsis is free software: you can redistribute it and/or modify
# it under the terms of the GNU Affero General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# Canopsis is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU Affero General Public License for more details.
#
# You should have received a copy of the GNU Affero General Public License
# along with Canopsis.  If not, see <http://www.gnu.org/licenses/>.
# ---------------------------------
*/

// initComponent -> doRefresh -> get_config -> createHighchartConfig -> doRefresh -> addDataOnChart

Ext.define('widgets.stock_graph.candle_graph' , {
	extend: 'widgets.line_graph.line_graph',

	alias: 'widget.candle_graph',

	logAuthor: '[candle_graph]',

	params: {'data_type': 'candlestick'},

	setOptions: function() {
		this.callParent();

		this.options.tooltip.formatter = undefined;
		this.options.chart.defaultSeriesType = 'candlestick';



		//this.options.xAxis.maxZoom = 60 * 5 * 1000 //5 minutes

	},

	createChart: function() {

	},

	onRefresh: function(data) {
		//if (this.chart){
		var data = [[1324339200000, 1374.5866190972592, 8988.515351859165, 4.54313158115837706, 8988.515351859165], [1324252800000, 18190.361632432447, 1374.5866190972592, 1374.5866190972592, 18190.361632432447], [1324166400000, 11808.627214308539, 18190.361632432447, 11808.627214308539, 19999.99999037729], [1324080000000, 304.32938020814436, 11808.627214308539, 6.94815771566936705, 11808.627214308539], [1323993600000, 16261.018098437191, 304.32938020814436, 304.32938020814436, 16261.018098437191], [1323907200000, 14484.664869665154, 16261.018098437191, 14484.664869665154, 19999.99981588027], [1323820800000, 6.423704829658163, 14484.664869665154, 6.423704829658163, 14484.664869665154], [1323734400000, 13832.925451861202, 6.423704829658163, 0.00035353717248653993, 13832.925451861202], [1323648000000, 16803.456692347077, 13832.925451861202, 13832.925451861202, 19999.9994222661], [1323561600000, 504.6005882874488, 16803.456692347077, 504.6005882874488, 16803.456692347077], [1323475200000, 11099.504161021898, 504.6005882874488, 0.0008567099102947395, 11099.504161021898], [1323388800000, 18580.28905501138, 11099.504161021898, 11099.504161021898, 19999.998809534794], [1323302400000, 1759.175545626129, 18580.28905501138, 1759.175545626129, 18580.28905501138], [1323216000000, 8278.496999008483, 1759.175545626129, 0.0015789997814863455, 8278.496999008483], [1323129600000, 19673.62051022082, 8278.496999008483, 8278.496999008483, 19999.997977686362], [1323043200000, 3670.209854931629, 19673.62051022082, 3670.209854931629, 19673.62051022082], [1322956800000, 5594.623779199118, 3670.209854931629, 0.0023045395773806376, 5594.623779199118], [1322870400000, 19996.35690100779, 5594.623779199118, 5594.623779199118, 19996.35690100779], [1322784000000, 6085.471618628796, 19996.35690100779, 6085.471618628796, 19999.9981705467], [1322697600000, 3261.680303748287, 6085.471618628796, 0.0014091463017393835, 6085.471618628796], [1322611200000, 19522.78923149146, 3261.680303748287, 3261.680303748287, 19522.78923149146], [1322524800000, 8812.562469175005, 19522.78923149146, 8812.562469175005, 19999.998956381416], [1322438400000, 1465.5075125460316, 8812.562469175005, 0.0007328701485675992, 8812.562469175005], [1322352000000, 18290.64163075192, 1465.5075125460316, 1465.5075125460316, 18290.64163075192], [1322265600000, 11634.243912725868, 18290.64163075192, 11634.243912725868, 19999.999523099003], [1322179200000, 349.18750047998765, 11634.243912725868, 0.0002757111269602319, 11634.243912725868], [1322092800000, 16398.066270333078, 349.18750047998765, 349.18750047998765, 16398.066270333078], [1322006400000, 14325.742423022479, 16398.066270333078, 14325.742423022479, 19999.999870699452], [1321920000000, 1.6456797787232063, 14325.742423022479, 1.6456797787232063, 14325.742423022479], [1321833600000, 13995.824618523406, 1.6456797787232063, 3.76692514691967505, 13995.824618523406], [1321747200000, 16672.654771641355, 13995.824618523406, 13995.824618523406, 19999.999999182754], [1321660800000, 450.5670326502768, 16672.654771641355, 450.5670326502768, 16672.654771641355], [1321574400000, 11275.277868216368, 450.5670326502768, 1.874452755146194205, 11275.277868216368], [1321488000000, 18488.02726626357, 11275.277868216368, 11275.277868216368, 19999.999908548903], [1321401600000, 1660.19074146994, 18488.02726626357, 1660.19074146994, 18488.02726626357], [1321315200000, 8453.143213982727, 1660.19074146994, 0.0002189369533880381, 8453.143213982727], [1321228800000, 19627.248374633324, 8453.143213982727, 8453.143213982727, 19999.999598797905], [1321142400000, 3534.158875012271, 19627.248374633324, 3534.158875012271, 19627.248374633324], [1321056000000, 5754.23028458457, 3534.158875012271, 0.0006382465253409464, 5754.23028458457], [1320969600000, 19999.568396318595, 5754.23028458457, 5754.23028458457, 19999.568396318595], [1320883200000, 5923.192206015159, 19999.568396318595, 5923.192206015159, 19999.999069929763], [1320796800000, 3393.5329368206803, 5923.192206015159, 0.0012766732324962504, 5923.192206015159], [1320710400000, 19575.3285318251, 3393.5329368206803, 3393.5329368206803, 19575.3285318251], [1320624000000, 8636.981708848905, 19575.3285318251, 8636.981708848905, 19999.99832194449], [1320537600000, 1559.1029681395958, 8636.981708848905, 0.0021342170639400138, 8636.981708848905], [1320451200000, 18388.323485562076, 1559.1029681395958, 1559.1029681395958, 18388.323485562076], [1320364800000, 11459.348467402868, 18388.323485562076, 11459.348467402868, 19999.997811802376], [1320278400000, 397.0700182559176, 11459.348467402868, 0.0017259590476896847, 11459.348467402868], [1320192000000, 16533.109399061883, 397.0700182559176, 397.0700182559176, 16533.109399061883], [1320105600000, 14165.464363617857, 16533.109399061883, 14165.464363617857, 19999.99868150025], [1320019200000, 0.0009658195958763827, 14165.464363617857, 0.0009658195958763827, 14165.464363617857], [1319932800000, 14157.471563607138, 0.0009658195958763827, 0.0009658195958763827, 14157.471563607138], [1319846400000, 16539.761755631385, 14157.471563607138, 14157.471563607138, 19999.999332081352], [1319760000000, 399.52610349626775, 16539.761755631385, 399.52610349626775, 16539.761755631385], [1319673600000, 11450.651927341934, 399.52610349626775, 0.0004247970809956314, 11450.651927341934], [1319587200000, 18393.10547548382, 11450.651927341934, 11450.651927341934, 19999.999763545107], [1319500800000, 1563.8194876194175, 18393.10547548382, 1563.8194876194175, 18393.10547548382], [1319414400000, 8628.274190233238, 1563.8194876194175, 0.00010289208876201883, 8628.274190233238], [1319328000000, 19577.859225099088, 8628.274190233238, 8628.274190233238, 19999.999975891333], [1319241600000, 3400.134174723118, 19577.859225099088, 3400.134174723118, 19577.859225099088], [1319155200000, 5915.167344691961, 3400.134174723118, 1.046246325131505707, 5915.167344691961], [1319068800000, 19999.646200026524, 5915.167344691961, 5915.167344691961, 19999.999969120032], [1318982400000, 5762.190389629645, 19999.646200026524, 5762.190389629645, 19999.646200026524], [1318896000000, 3527.455926554002, 5762.190389629645, 0.00011643469406408258, 5762.190389629645], [1318809600000, 19624.86709166254, 3527.455926554002, 3527.455926554002, 19624.86709166254], [1318723200000, 8461.82808847492, 19624.86709166254, 8461.82808847492, 19999.999743231197], [1318636800000, 1655.3436584641986, 8461.82808847492, 0.0004518822915997589, 8461.82808847492], [1318550400000, 18483.376588910854, 1655.3436584641986, 1655.3436584641986, 18483.376588910854], [1318464000000, 11283.995679926713, 18483.376588910854, 11283.995679926713, 19999.999298224837], [1318377600000, 447.9619303781383, 11283.995679926713, 0.001006447411782574, 11283.995679926713], [1318291200000, 16666.1051707807, 447.9619303781383, 447.9619303781383, 16666.1051707807], [1318204800000, 14003.880911656655, 16666.1051707807, 14003.880911656655, 19999.998634100964], [1318118400000, 1.4900785384015762, 14003.880911656655, 0.001780130038241623, 14003.880911656655], [1318032000000, 14317.815636561256, 1.4900785384015762, 1.4900785384015762, 14317.815636561256], [1317945600000, 16404.819285471254, 14317.815636561256, 14317.815636561256, 19999.997750859584], [1317859200000, 351.49379469104497, 16404.819285471254, 351.49379469104497, 16404.819285471254], [1317772800000, 11625.571384225797, 351.49379469104497, 0.002074862090012175, 11625.571384225797], [1317686400000, 18295.553427019753, 11625.571384225797, 11625.571384225797, 19999.998374528368], [1317600000000, 1470.0919834716806, 18295.553427019753, 1470.0919834716806, 18295.553427019753], [1317513600000, 8803.8350473964, 1470.0919834716806, 0.0012308605473663192, 8803.8350473964], [1317427200000, 19525.46853858314, 8803.8350473964, 8803.8350473964, 19999.999108971162], [1317340800000, 3268.177754477373, 19525.46853858314, 3268.177754477373, 19525.46853858314], [1317254400000, 6077.384524905452, 3268.177754477373, 0.0006059765073587187, 6077.384524905452], [1317168000000, 19996.5902875099, 6077.384524905452, 6077.384524905452, 19999.99962429644], [1317081600000, 5602.516626069338, 19996.5902875099, 5602.516626069338, 19996.5902875099], [1316995200000, 3663.4073022444572, 5602.516626069338, 0.00020020998817926738, 5602.516626069338], [1316908800000, 19671.389385384296, 3663.4073022444572, 3663.4073022444572, 19671.389385384296], [1316822400000, 8287.156502061016, 19671.389385384296, 8287.156502061016, 19999.9999205042], [1316736000000, 1754.199420987834, 8287.156502061016, 1.356099528493359705, 8287.156502061016], [1316649600000, 18575.771149625303, 1754.199420987834, 1754.199420987834, 18575.771149625303], [1316563200000, 11108.24050909013, 18575.771149625303, 11108.24050909013, 19999.99999759443], [1316476800000, 501.84728636836553, 11108.24050909013, 4.60295323136961105, 11108.24050909013], [1316390400000, 16797.011900753023, 501.84728636836553, 501.84728636836553, 16797.011900753023], [1316304000000, 13841.042712542187, 16797.011900753023, 13841.042712542187, 19999.999855567126], [1316217600000, 6.112551430616804, 13841.042712542187, 0.0002976156010845443, 13841.042712542187], [1316131200000, 14476.806580733384, 6.112551430616804, 6.112551430616804, 14476.806580733384], [1316044800000, 16267.869655661869, 14476.806580733384, 14476.806580733384, 19999.999494422293], [1315958400000, 306.48516094481784, 16267.869655661869, 306.48516094481784, 16267.869655661869], [1315872000000, 11799.981415137754, 306.48516094481784, 0.0007683191943215206, 11799.981415137754], [1315785600000, 18195.40169551003, 11799.981415137754, 11799.981415137754, 19999.998914159944], [1315699200000, 1379.0376050468549, 18195.40169551003, 1379.0376050468549, 18195.40169551003], [1315612800000, 8979.770761978592, 1379.0376050468549, 0.0014581403011106886, 8979.770761978592], [1315526400000, 19470.0927348861, 8979.770761978592, 8979.770761978592, 19999.99811478008], [1315440000000, 3138.330970955927, 19470.0927348861, 3138.330970955927, 19470.0927348861], [1315353600000, 6240.830985001825, 3138.330970955927, 0.0023670789087191224, 6240.830985001825], [1315267200000, 19990.40161639996, 6240.830985001825, 6240.830985001825, 19999.99803546084], [1315180800000, 5444.22095778276, 19990.40161639996, 5444.22095778276, 19990.40161639996], [1315094400000, 3801.344456550949, 5444.22095778276, 0.001527997312223306, 5444.22095778276], [1315008000000, 19714.88083285398, 3801.344456550949, 3801.344456550949, 19714.88083285398], [1314921600000, 8113.021691190854, 19714.88083285398, 8113.021691190854, 19999.99885376516], [1314835200000, 1855.6392748745957, 8113.021691190854, 0.0008192517525458243, 8113.021691190854], [1314748800000, 18665.478211903723, 1855.6392748745957, 1855.6392748745957, 18665.478211903723], [1314662400000, 10932.138034835236, 18665.478211903723, 10932.138034835236, 19999.99945295196], [1314576000000, 558.7091992323294, 10932.138034835236, 0.0003296237046015449, 10932.138034835236], [1314489600000, 16925.78856457691, 558.7091992323294, 558.7091992323294, 16925.78856457691], [1314403200000, 13677.000797374603, 16925.78856457691, 13677.000797374603, 19999.999833021204], [1314316800000, 13.866935863345134, 13677.000797374603, 5.91132429690333105, 13677.000797374603], [1314230400000, 14634.394570427066, 13.866935863345134, 13.866935863345134, 14634.394570427066], [1314144000000, 16128.955784620523, 14634.394570427066, 14634.394570427066, 19999.999993972975], [1314057600000, 264.51430745495963, 16128.955784620523, 264.51430745495963, 16128.955784620523], [1313971200000, 11973.827361631673, 264.51430745495963, 7.720142093603506, 11973.827361631673], [1313884800000, 18092.68166770963, 11973.827361631673, 11973.827361631673, 19999.999935807406], [1313798400000, 1290.6848880946582, 18092.68166770963, 1290.6848880946582, 18092.68166770963], [1313712000000, 9156.02619677678, 1290.6848880946582, 0.00017544438196637202, 9156.02619677678], [1313625600000, 19411.74916857209, 9156.02619677678, 9156.02619677678, 19999.999658524495], [1313539200000, 3010.634517618164, 19411.74916857209, 3010.634517618164, 19411.74916857209], [1313452800000, 6405.455501248074, 3010.634517618164, 0.0005622859571303707, 6405.455501248074], [1313366400000, 19981.08212629245, 6405.455501248074, 6405.455501248074, 19999.999162124255], [1313280000000, 5287.352994561101, 19981.08212629245, 5287.352994561101, 19981.08212629245], [1313193600000, 3941.2241597870234, 5287.352994561101, 0.0011682448639476206, 5287.352994561101], [1313107200000, 19755.32780384947, 3941.2241597870234, 3941.2241597870234, 19755.32780384947], [1313020800000, 7939.478230261587, 19755.32780384947, 7939.478230261587, 19999.99844660669], [1312934400000, 1959.6314283444763, 7939.478230261587, 0.0019933210860472172, 7939.478230261587], [1312848000000, 18752.4696611471, 1959.6314283444763, 1959.6314283444763, 18752.4696611471], [1312761600000, 10755.743448870642, 18752.4696611471, 10755.743448870642, 19999.997664294708], [1312675200000, 618.5298478872865, 10755.743448870642, 0.00185723258255166, 10755.743448870642], [1312588800000, 17052.394802908235, 618.5298478872865, 618.5298478872865, 17052.394802908235], [1312502400000, 13511.80657759999, 17052.394802908235, 13511.80657759999, 19999.9985664608], [1312416000000, 24.75080147958215, 13511.80657759999, 0.0010646251448633848, 13511.80657759999], [1312329600000, 14790.53021771065, 24.75080147958215, 24.75080147958215, 14790.53021771065], [1312243200000, 15988.121207628134, 14790.53021771065, 14790.53021771065, 19999.99924950958], [1312156800000, 225.59438755283918, 15988.121207628134, 225.59438755283918, 15988.121207628134], [1312070400000, 12147.054741715321, 225.59438755283918, 0.0004911350242764456, 12147.054741715321], [1311984000000, 17987.42553516415, 12147.054741715321, 12147.054741715321, 19999.999713441037], [1311897600000, 1205.061521181331, 17987.42553516415, 1205.061521181331, 17987.42553516415], [1311811200000, 9332.546115871904, 1205.061521181331, 0.00013676223534275778, 9332.546115871904], [1311724800000, 19350.456123622465, 9332.546115871904, 9332.546115871904, 19999.999958255165], [1311638400000, 2885.128411888373, 19350.456123622465, 2885.128411888373, 19350.456123622465], [1311552000000, 6571.20648406172, 2885.128411888373, 1.506779881310649206, 6571.20648406172], [1311465600000, 19968.634737783686, 6571.20648406172, 6571.20648406172, 19999.99998395192], [1311379200000, 5131.961894264156, 19968.634737783686, 5131.961894264156, 19968.634737783686], [1311292800000, 4083.0025780162314, 5131.961894264156, 8.5368743384606205, 5131.961894264156], [1311206400000, 19792.717623785255, 4083.0025780162314, 4083.0025780162314, 19792.717623785255], [1311120000000, 7766.580501280057, 19792.717623785255, 7766.580501280057, 19999.999790531234], [1311033600000, 2066.143294371228, 7766.580501280057, 0.0003883481422235491, 7766.580501280057], [1310947200000, 18836.718238074398, 2066.143294371228, 2066.143294371228, 18836.718238074398], [1310860800000, 10579.112025136996, 18836.718238074398, 10579.112025136996, 19999.999377993125], [1310774400000, 681.2904873895823, 10579.112025136996, 0.0009104449691221816, 10579.112025136996], [1310688000000, 17176.790943639153, 681.2904873895823, 681.2904873895823, 17176.790943639153], [1310601600000, 13345.511817078415, 17176.790943639153, 13345.511817078415, 19999.998746337587], [1310515200000, 38.76073773463577, 13345.511817078415, 0.001651659211347578, 13345.511817078415], [1310428800000, 14945.164597112263, 38.76073773463577, 38.76073773463577, 14945.164597112263], [1310342400000, 15845.410055664666, 14945.164597112263, 14945.164597112263, 19999.997895564644], [1310256000000, 189.7375968994038, 15845.410055664666, 189.7375968994038, 15845.410055664666], [1310169600000, 12319.609273859089, 189.7375968994038, 0.0022185638608789304, 12319.609273859089], [1310083200000, 17879.666280410136, 12319.609273859089, 12319.609273859089, 19999.99824706065], [1309996800000, 1122.1943348383738, 17879.666280410136, 1122.1943348383738, 17879.666280410136], [1309910400000, 9509.275205690183, 1122.1943348383738, 0.0013420941886579385, 9509.275205690183], [1309824000000, 19286.232806697604, 9509.275205690183, 9509.275205690183, 19999.999013971617], [1309737600000, 2761.8519823879406, 19286.232806697604, 2761.8519823879406, 19286.232806697604], [1309651200000, 6738.0319932833, 2761.8519823879406, 0.0006847419244877528, 6738.0319932833], [1309564800000, 19953.063351436755, 6738.0319932833, 6738.0319932833, 19999.999561765162], [1309478400000, 4978.096351426783, 19953.063351436755, 4978.096351426783, 19953.063351436755], [1309392000000, 4226.635282151014, 4978.096351426783, 0.0002465070992911933, 4978.096351426783], [1309305600000, 19827.038575696366, 4226.635282151014, 4226.635282151014, 19827.038575696366], [1309219200000, 7594.382686040293, 19827.038575696366, 7594.382686040293, 19999.999890441286], [1309132800000, 2175.1414945997303, 7594.382686040293, 2.738967850746121305, 7594.382686040293], [1309046400000, 18918.19754086569, 2175.1414945997303, 2175.1414945997303, 18918.19754086569], [1308960000000, 20000, 18918.19754086569, 18918.19754086569, 20000]];

		this.options = {
			chart: {
				renderTo: this.divId,
				//zoomType: 'x',
				height: this.divHeight,
				animation: false
			},
			rangeSelector: {
				selected: 1
			},

			title: {
				text: 'AAPL Stock Price'
			},

			series: [{
				type: 'candlestick',
				name: 'fs1',
				data: data,
				dataGrouping: {
					units: [
						['week', // unit name
						[1] // allowed multiples
					], [
						'month',
						[1, 2, 3, 4, 6]]
					]
				}
			}]
		};

		this.chart = new Highcharts.StockChart(this.options);
		//}
		return true;
	}
});
